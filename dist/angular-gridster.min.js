/*
 * angular-gridster
 * http://manifestwebdesign.github.io/angular-gridster
 *
 * @version: 0.9.8
 * @license: MIT
 */
"use strict";angular.module("gridster",[]).constant("gridsterConfig",{columns:6,width:"auto",colWidth:"auto",rowHeight:"match",margins:[10,10],isMobile:!1,minColumns:1,minRows:1,maxRows:100,defaultSizeX:2,defaultSizeY:1,mobileBreakPoint:600,resizable:{enabled:!0},draggable:{enabled:!0}}).controller("GridsterCtrl",["$scope","$attrs","$document","$timeout","gridsterConfig",function(a,b,c,d,e){var f=this;this.grid=[],this.$preview=null,this.$element=null,this.config=angular.extend({},e),this.init=function(b,c){f.$element=b,f.$preview=c,f.$element.addClass("gridster"),f.resolveConfig(),a.$watch("config",function(b,c){b&&b!==c&&(f.resolveConfig(),"undefined"!=typeof c.draggable&&"undefined"!=typeof c.draggable&&b.draggable!==c.draggable&&a.$broadcast("draggable-changed",c.draggable),"undefined"!=typeof c.resizable&&"undefined"!=typeof c.resizable&&b.resizable!==c.resizable&&a.$broadcast("resizable-changed",c.resizable))},!0),a.$watch(function(){return f.config.isMobile},function(a){a?f.$element.addClass("gridster-mobile"):f.$element.removeClass("gridster-mobile")});var d=f.$element.width();angular.element(window).on("resize",function(){var c=b.width();c===d||f.$element.find(".gridster-item-moving").length>0||(f.resolveConfig(),d=c,a.$broadcast("gridster-resized",[c,f.$element.height()]),a.$apply())}),a.$on("$destroy",function(){try{f.destroy()}catch(a){}})},this.resolveConfig=function(){$.extend(!0,f.config,a.config),f.config._width="auto"===f.config.width?f.$element.width():f.config.width,f.config._colWidth="auto"===f.config.colWidth?(f.config._width-f.config.margins[1])/f.config.columns:f.config.colWidth,f.config._rowHeight="match"===f.config.rowHeight?f.config._colWidth:f.config.rowHeight,f.redraw()},this.destroy=function(){f.$preview.remove(),f.config=f.config.margins=f.grid=f.$element=f.$preview=null},this.redraw=function(){f.$element.removeClass("gridster-loaded"),f.config.isMobile=f.config._width<=f.config.mobileBreakPoint;for(var a=0,b=f.grid.length;b>a;++a){var c=f.grid[a];if(c)for(var d=0,e=c.length;e>d;++d)if(c[d]){var g=c[d],h=g.$element;f.setElementPosition(h,g.row,g.col),f.setElementSizeY(h,g.sizeY),f.setElementSizeX(h,g.sizeX)}}f.floatItemsUp(),f.updateHeight(),f.$element.addClass("gridster-loaded")},this.canItemOccupy=function(a,b,c){return b>-1&&c>-1&&a.sizeX+c<=f.config.columns},this.autoSetItemPosition=function(a){for(var b=0;b<f.config.maxRows;++b)for(var c=0;c<f.config.columns;++c)if(!f.getItem(b,c)&&f.canItemOccupy(a,b,c))return void f.putItem(a,b,c);throw new Error("Unable to place item!")},this.getItems=function(a,b,c,d,e){var g=[];c&&d||(c=d=1),!e||e instanceof Array||(e=[e]);for(var h=0;d>h;++h)for(var i=0;c>i;++i){var j=f.getItem(a+h,b+i,e);!j||e&&-1!==e.indexOf(j)||-1!==g.indexOf(j)||g.push(j)}return g},this.removeItem=function(a){for(var b=0,c=f.grid.length;c>b;++b){var d=f.grid[b];if(d){var e=d.indexOf(a);if(-1!==e){d[e]=null;break}}}f.floatItemsUp(),f.updateHeight()},this.getItem=function(a,b,c){!c||c instanceof Array||(c=[c]);for(var d=1;a>-1;){for(var e=1,g=b;g>-1;){var h=f.grid[a];if(h){var i=h[g];if(i&&(!c||-1===c.indexOf(i))&&i.sizeX>=e&&i.sizeY>=d)return i}++e,--g}--a,++d}return null},this.putItems=function(a){for(var b=0,c=a.length;c>b;++b)f.putItem(a[b])},this.putItem=function(a,b,c){if(("undefined"==typeof b||null===b)&&(b=a.row,c=a.col,"undefined"==typeof b||null===b))return void f.autoSetItemPosition(a);if(f.canItemOccupy(a,b,c)||(c=Math.min(f.config.columns-a.sizeX,Math.max(0,c)),b=Math.max(0,b)),a&&null!==a.oldRow&&"undefined"!=typeof a.oldRow){if(a.oldRow===b&&a.oldColumn===c)return a.row=b,void(a.col=c);var d=f.grid[a.oldRow];d&&d[a.oldColumn]===a&&delete d[a.oldColumn]}a.oldRow=a.row=b,a.oldColumn=a.col=c,f.moveOverlappingItems(a),f.grid[b]||(f.grid[b]=[]),f.grid[b][c]=a},this.moveOverlappingItems=function(a){var b=f.getItems(a.row,a.col,a.sizeX,a.sizeY,a);f.moveItemsDown(b,a.row+a.sizeY)},this.moveItemsDown=function(a,b){if(a&&0!==a.length){var c,d,e,g={};for(d=0,e=a.length;e>d;++d){c=a[d];var h=g[c.col];("undefined"==typeof h||c.row<h)&&(g[c.col]=c.row)}for(d=0,e=a.length;e>d;++d){c=a[d];var i=b-g[c.col];f.putItem(c,c.row+i,c.col)}}},this.floatItemsUp=function(){for(var a=0,b=f.grid.length;b>a;++a){var c=f.grid[a];if(c)for(var d=0,e=c.length;e>d;++d)c[d]&&f.floatItemUp(c[d])}},this.floatItemUp=function(a){for(var b=a.col,c=a.sizeY,d=a.sizeX,e=null,g=null,h=a.row-1;h>-1;){var i=f.getItems(h,b,d,c,a);if(0!==i.length)break;e=h,g=b,--h}null!==e&&f.putItem(a,e,g)},this.updateHeight=function(a){var b=f.config.minRows;a||(a=0);for(var c=f.grid.length;c>=0;--c){var d=f.grid[c];if(d)for(var e=0,g=d.length;g>e;++e)d[e]&&(b=Math.max(b,c+a+d[e].sizeY))}var h=Math.min(f.config.maxRows,b);f.config.isMobile?f.$element.css("height","100%"):f.$element.css("height",h*f.config._rowHeight+f.config.margins[0]+"px")},this.pixelsToRows=function(a,b){return b===!0?Math.ceil(a/f.config._rowHeight):b===!1?Math.floor(a/f.config._rowHeight):Math.round(a/f.config._rowHeight)},this.pixelsToColumns=function(a,b){return b===!0?Math.ceil(a/f.config._colWidth):b===!1?Math.floor(a/f.config._colWidth):Math.round(a/f.config._colWidth)},this.setElementPosition=function(a,b,c){a.css(f.config.isMobile?{margin:f.config.margins[0]+"px",top:"auto",left:"auto"}:{margin:0,top:b*f.config._rowHeight+f.config.margins[0],left:c*f.config._colWidth+f.config.margins[1]})},this.setElementSizeY=function(a,b){f.config.isMobile?a.css("height","auto"):a.css("height",b*f.config._rowHeight-f.config.margins[0]+"px")},this.setElementSizeX=function(a,b){f.config.isMobile?a.css("width","auto"):a.css("width",b*f.config._colWidth-f.config.margins[1]+"px")}}]).directive("gridster",[function(){return{restrict:"EA",controller:"GridsterCtrl",scope:{config:"=?gridster"},compile:function(){return{pre:function(a,b,c,d){var e=angular.element('<div class="gridster-item gridster-preview-holder"></div>').appendTo(b);d.init(b,e)}}}}}]).controller("GridsterItemCtrl",["$scope","$attrs","$timeout",function(a,b,c){var d=this;this.init=function(e,f){e.addClass("gridster-item"),e.addClass("gridster-item-moving"),d.itemKey=b.gridsterItem||"item",d.item=a[d.itemKey],d.item.sizeX=d.item.sizeX||f.config.defaultSizeX,d.item.sizeY=d.item.sizeY||f.config.defaultSizeY,d.item.$element=e,d.dragging=!1,d.resizing=!1,d.draggablePossible="function"==typeof e.draggable,d.resizablePossible="function"==typeof e.resizable,d.$element=e,d.GridsterCtrl=f;var g=function(){d.setPosition(d.item.row,d.item.col)};a.$watch(d.itemKey+".row",g),a.$watch(d.itemKey+".col",g),a.$watch(d.itemKey+".sizeX",function(a){d.setSizeX(a)}),a.$watch(d.itemKey+".sizeY",function(a){d.setSizeY(a)}),d.setDraggable("undefined"!=typeof f.config.draggable&&"undefined"!=typeof f.config.draggable.enabled&&f.config.draggable.enabled),d.setResizable("undefined"!=typeof f.config.resizable&&"undefined"!=typeof f.config.resizable.enabled&&f.config.resizable.enabled),c(function(){e.removeClass("gridster-item-moving")},100)},a.$on("draggable-changed",function(a,b){d.setDraggable(b.enabled)}),a.$on("resizable-changed",function(a,b){d.setResizable(b.enabled)}),a.$on("gridster-resized",function(){d.updateResizableDimensions("undefined"!=typeof d.GridsterCtrl.config.resizable&&"undefined"!=typeof d.GridsterCtrl.config.resizable.enabled&&d.GridsterCtrl.config.resizable.enabled)}),a.$on("$destroy",function(){try{d.GridsterCtrl.removeItem(d.item),d.GridsterCtrl=null,d.$element.draggable("destroy"),d.$element.resizable("destroy"),d.$element=null}catch(a){}}),this.setPosition=function(a,b){d.GridsterCtrl.putItem(d.item,a,b),d.GridsterCtrl.floatItemsUp(),d.GridsterCtrl.updateHeight(d.item.sizeY),d.dragging?d.GridsterCtrl.setElementPosition(d.GridsterCtrl.$preview,d.item.row,d.item.col):d.GridsterCtrl.setElementPosition(d.$element,d.item.row,d.item.col)},this.setSize=function(a,b){if(""!==b){b=parseInt(b,10),a=a.toUpperCase();var c="size"+a,e="Size"+a;(isNaN(b)||0===b)&&(b=d.GridsterCtrl.config["default"+e]),d.item["old"+e]=d.item[c]=b,d.resizing?(d.GridsterCtrl.setElementPosition(d.GridsterCtrl.$preview,d.item.row,d.item.col),d.GridsterCtrl["setElement"+e](d.GridsterCtrl.$preview,b)):d.GridsterCtrl["setElement"+e](d.$element,b),d.GridsterCtrl.moveOverlappingItems(d.item),d.GridsterCtrl.floatItemsUp(),d.GridsterCtrl.updateHeight(d.item.sizeY)}},this.setSizeY=function(a){d.setSize("y",a)},this.setSizeX=function(a){d.setSize("x",a)},this.setDraggable=function(b){if(d.draggablePossible)if(b)d.$element.draggable({handle:d.GridsterCtrl.config.draggable&&d.GridsterCtrl.config.draggable.handle?d.GridsterCtrl.config.draggable.handle:null,refreshPositions:!0,start:function(b,c){d.$element.addClass("gridster-item-moving"),d.dragging=!0,d.GridsterCtrl.$preview.fadeIn(300),d.GridsterCtrl.setElementSizeX(d.GridsterCtrl.$preview,d.item.sizeX),d.GridsterCtrl.setElementSizeY(d.GridsterCtrl.$preview,d.item.sizeY),d.GridsterCtrl.setElementPosition(d.GridsterCtrl.$preview,d.item.row,d.item.col),d.GridsterCtrl.updateHeight(d.item.sizeY),a.$apply(function(){d.GridsterCtrl.config.draggable&&d.GridsterCtrl.config.draggable.start&&d.GridsterCtrl.config.draggable.start(b,c,d.$element)})},drag:function(b,c){d.item.row=d.GridsterCtrl.pixelsToRows(c.position.top),d.item.col=d.GridsterCtrl.pixelsToColumns(c.position.left),a.$apply(function(){d.GridsterCtrl.config.draggable&&d.GridsterCtrl.config.draggable.drag&&d.GridsterCtrl.config.draggable.drag(b,c,d.$element)})},stop:function(b,c){d.$element.removeClass("gridster-item-moving"),d.item.row=d.GridsterCtrl.pixelsToRows(c.position.top),d.item.col=d.GridsterCtrl.pixelsToColumns(c.position.left),d.dragging=!1,d.GridsterCtrl.$preview.fadeOut(300),d.setPosition(d.item.row,d.item.col),d.GridsterCtrl.updateHeight(),a.$apply(function(){d.GridsterCtrl.config.draggable&&d.GridsterCtrl.config.draggable.stop&&d.GridsterCtrl.config.draggable.stop(b,c,d.$element)})}});else try{d.$element.draggable("destroy")}catch(c){}},this.setResizable=function(b){if(d.resizablePossible)if(b)d.$element.resizable({autoHide:!0,handles:"n, e, s, w, ne, se, sw, nw",minHeight:d.GridsterCtrl.config.minRows*d.GridsterCtrl.config._rowHeight-d.GridsterCtrl.config.margins[0],maxHeight:d.GridsterCtrl.config.maxRows*d.GridsterCtrl.config._rowHeight-d.GridsterCtrl.config.margins[0],minWidth:d.GridsterCtrl.config.minColumns*d.GridsterCtrl.config._colWidth-d.GridsterCtrl.config.margins[1],maxWidth:d.GridsterCtrl.config.columns*d.GridsterCtrl.config._colWidth-d.GridsterCtrl.config.margins[1],start:function(b,c){d.$element.addClass("gridster-item-moving"),d.resizing=!0,d.GridsterCtrl.$preview.fadeIn(300),d.GridsterCtrl.setElementSizeX(d.GridsterCtrl.$preview,d.item.sizeX),d.GridsterCtrl.setElementSizeY(d.GridsterCtrl.$preview,d.item.sizeY),a.$apply(function(){d.GridsterCtrl.config.resizable&&d.GridsterCtrl.config.resizable.start&&d.GridsterCtrl.config.resizable.start(b,c,d.$element)})},resize:function(b,c){d.item.row=d.GridsterCtrl.pixelsToRows(c.position.top,!1),d.item.col=d.GridsterCtrl.pixelsToColumns(c.position.left,!1),d.item.sizeX=d.GridsterCtrl.pixelsToColumns(c.size.width,!0),d.item.sizeY=d.GridsterCtrl.pixelsToRows(c.size.height,!0),a.$apply(function(){d.GridsterCtrl.config.resizable&&d.GridsterCtrl.config.resizable.resize&&d.GridsterCtrl.config.resizable.resize(b,c,d.$element)})},stop:function(b,c){d.$element.removeClass("gridster-item-moving"),d.item.row=d.GridsterCtrl.pixelsToRows(c.position.top,!1),d.item.col=d.GridsterCtrl.pixelsToColumns(c.position.left,!1),d.item.sizeX=d.GridsterCtrl.pixelsToColumns(c.size.width,!0),d.item.sizeY=d.GridsterCtrl.pixelsToRows(c.size.height,!0),d.resizing=!1,d.GridsterCtrl.$preview.fadeOut(300),d.setPosition(d.item.row,d.item.col),d.setSizeY(d.item.sizeY),d.setSizeX(d.item.sizeX),a.$apply(function(){d.GridsterCtrl.config.resizable&&d.GridsterCtrl.config.resizable.stop&&d.GridsterCtrl.config.resizable.stop(b,c,d.$element)})}});else try{d.$element.resizable("destroy")}catch(c){}},this.updateResizableDimensions=function(a){d.resizablePossible&&a&&(d.$element.resizable("option","minHeight",d.GridsterCtrl.config.minRows*d.GridsterCtrl.config._rowHeight-d.GridsterCtrl.config.margins[0]),d.$element.resizable("option","maxHeight",d.GridsterCtrl.config.maxRows*d.GridsterCtrl.config._rowHeight-d.GridsterCtrl.config.margins[0]),d.$element.resizable("option","minWidth",d.GridsterCtrl.config.minColumns*d.GridsterCtrl.config._colWidth-d.GridsterCtrl.config.margins[1]),d.$element.resizable("option","maxWidth",d.GridsterCtrl.config.columns*d.GridsterCtrl.config._colWidth-d.GridsterCtrl.config.margins[1]))}}]).directive("gridsterItem",[function(){return{restrict:"EA",require:["^gridster","gridsterItem"],controller:"GridsterItemCtrl",link:function(a,b,c,d){var e=d[0],f=d[1];f.init(b,e)}}}]);